<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Auth Demo</title>
    <style>
      body {
        background: #f6f8fa;
        font-family: Segoe UI, Arial, Helvetica, sans-serif;
      }
      .card {
        max-width: 340px;
        margin: 48px auto;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 16px #0002;
        padding: 32px;
      }
      h1, h2 {
        color: #0b5cff;
        margin-bottom: 18px;
      }
      label {
        display: block;
        margin-top: 12px;
        font-weight: 500;
      }
      input {
        width: 100%;
        padding: 10px;
        margin: 8px 0;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-size: 16px;
      }
      button {
        padding: 10px 18px;
        border-radius: 6px;
        border: none;
        background: #0b5cff;
        color: #fff;
        font-weight: 600;
        font-size: 16px;
        cursor: pointer;
        margin-right: 8px;
      }
      .switch {
        background: #eee;
        color: #333;
        border: 1px solid #ccc;
      }
      .hidden { display: none; }
      .msg { margin-top: 16px; font-weight: 500; }
      .error { color: #d32f2f; }
      .success { color: #388e3c; }
      .info { color: #555; font-size: 14px; margin-top: 24px; }
    </style>
  </head>
  <body>
    <div class="card">
      <h1>Budget Ally Demo</h1>
      <div id="forms">
        <div>
          <h2>Register</h2>
          <label>Username <input id="reg-username" /></label>
          <label>Password <input id="reg-password" type="password" /></label>
          <button id="btn-register">Register</button>
        </div>
        <hr />
        <div>
          <h2>Login</h2>
          <label>Username <input id="login-username" /></label>
          <label>Password <input id="login-password" type="password" /></label>
          <button id="btn-login">Login</button>
        </div>
        <div style="margin-top: 18px">
          <span id="msg" class="msg"></span>
        </div>
      </div>
      <div id="hello" class="hidden">
        <h2 id="hello-msg">Hello</h2>
        <button id="btn-logout">Logout</button>
      </div>
      <div class="info">
        Credentials are stored in SQLite and a simple token is used for authentication.<br />
        <span style="color: #0b5cff">Budget Ally Demo</span>
      </div>
    </div>

    <script>
      const API = 'http://localhost:5000'
      const $ = id => document.getElementById(id)

      function setMsg(text, type) {
        const el = $('msg');
        el.textContent = text;
        el.className = 'msg ' + (type || '');
      }

      $('btn-register').addEventListener('click', async () => {
        const username = $('reg-username').value;
        const password = $('reg-password').value;
        setMsg('','');
        const res = await fetch(API + '/api/register', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({username, password}) });
        const body = await res.json();
        if (res.ok) {
          setMsg('Registered! Please login.','success');
        } else {
          setMsg(body.error || 'Register failed','error');
        }
      });

      $('btn-login').addEventListener('click', async () => {
        const username = $('login-username').value;
        const password = $('login-password').value;
        setMsg('','');
        const res = await fetch(API + '/api/login', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({username, password}) });
        const body = await res.json();
        if (res.ok && body.token) {
          localStorage.setItem('token', body.token);
          showHello();
        } else {
          setMsg(body.error || 'Login failed','error');
        }
      });

      $('btn-logout').addEventListener('click', () => {
        localStorage.removeItem('token');
        $('hello').classList.add('hidden');
        $('forms').classList.remove('hidden');
        setMsg('','');
      });

      async function showHello() {
        const token = localStorage.getItem('token');
        if (!token) return;
        const res = await fetch(API + '/api/hello', { headers: { Authorization: 'Bearer ' + token } });
        const body = await res.json();
        if (res.ok && body.message) {
          $('hello-msg').textContent = body.message;
          $('forms').classList.add('hidden');
          $('hello').classList.remove('hidden');
        } else {
          setMsg(body.error || 'Could not fetch hello','error');
          localStorage.removeItem('token');
        }
      }

      // auto-show if token exists
      if (localStorage.getItem('token')) showHello();
    </script>
  </body>
</html>
